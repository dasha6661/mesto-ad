(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:o,onInfoClick:n},c)=>{const s=z(),f=s.querySelector(".card__like-button"),v=s.querySelector(".card__control-button_type_delete"),P=s.querySelector(".card__control-button_type_info"),C=s.querySelector(".card__image"),T=s.querySelector(".card__like-count");return C.src=e.link,C.alt=e.name,s.querySelector(".card__title").textContent=e.name,T&&e.likes&&(T.textContent=e.likes.length),e.owner._id!==c&&v.remove(),r&&f.addEventListener("click",()=>r(f,e._id)),o&&v&&v.addEventListener("click",()=>o(s,e._id)),n&&P&&P.addEventListener("click",()=>n(e._id)),t&&C.addEventListener("click",()=>t({name:e.name,link:e.link})),s},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},K=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&u(e)})},G=(e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)},N=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""},Q=(e,t,r)=>{if(t.validity.valid)N(e,t,r);else{let o="";t.validity.patternMismatch&&t.hasAttribute("data-error-message")?o=t.dataset.errorMessage:o=t.validationMessage,G(e,t,o,r)}},X=e=>e.some(t=>!t.validity.valid),Y=(e,t,r)=>{X(e)?q(t,r):Z(t,r)},q=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},Z=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},ee=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);q(o,t),r.forEach(n=>{n.addEventListener("input",()=>{Q(e,n,t),Y(r,o,t)})})},te=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(r=>{r.addEventListener("submit",o=>o.preventDefault()),ee(r,e)})},S=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach(n=>{N(e,n,t)}),q(o,t)},a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"bbd0ba39-a453-4894-b620-a60328db7664","Content-Type":"application/json"}},l=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),oe=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(l),D=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(l),re=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(l),ne=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(l),ce=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(l),O=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(l),se=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(l),m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(m);const W=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),b=g.querySelector(".popup__form"),H=b.querySelector(".popup__input_type_name"),j=b.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),i=k.querySelector(".popup__form"),ae=i.querySelector(".popup__input_type_card-name"),ie=i.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),U=E.querySelector(".popup__image"),le=E.querySelector(".popup__caption"),ue=document.querySelector(".profile__edit-button"),de=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),h=M.querySelector(".popup__form"),pe=h.querySelector(".popup__input"),_=document.querySelector(".popup_type_info"),me=_.querySelector(".popup__title"),d=_.querySelector(".popup__info"),w=_.querySelector(".popup__list"),A=_.querySelector(".popup__text");let L;const _e=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),y=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e+":",o.querySelector(".popup__info-description").textContent=t,o},fe=e=>{const r=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),o=r.querySelector(".popup__list-item_type_badge");return o.textContent=e.name,o.title=e.about,r},J=({name:e,link:t})=>{U.src=t,U.alt=e,le.textContent=e,p(E)},V=(e,t)=>{const r=e.classList.contains("card__like-button_is-active"),o=e.closest(".card").querySelector(".card__like-count");se(t,r).then(n=>{o.textContent=n.likes.length,e.classList.toggle("card__like-button_is-active")}).catch(n=>console.error(n))},R=e=>{D().then(t=>{const r=t.find(o=>o._id===e);r&&(me.textContent="Информация о карточке",d.innerHTML="",w.innerHTML="",d.append(y("Описание",r.name)),d.append(y("Дата создания",_e(r.createdAt))),d.append(y("Владелец",r.owner.name)),d.append(y("Количество лайков",r.likes.length.toString())),r.likes.length>0?(A.textContent="Лайкнули:",r.likes.forEach(o=>{w.append(fe(o))})):A.textContent="Пока никто не лайкнул",p(_))}).catch(t=>console.error(t))},ye=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,re({name:H.value,about:j.value}).then(o=>{x.textContent=o.name,I.textContent=o.about,u(g)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})},he=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,ne(pe.value).then(o=>{B.style.backgroundImage=`url(${o.avatar})`,u(M)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})},Se=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Создание...",t.disabled=!0,ce({name:ae.value,link:ie.value}).then(o=>{const n=$(o,{onPreviewPicture:J,onLikeIcon:V,onDeleteCard:(c,s)=>{O(s).then(()=>c.remove()).catch(f=>console.error(f))},onInfoClick:R},L);W.prepend(n),u(k),i.reset(),S(i,m)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})};b.addEventListener("submit",ye);i.addEventListener("submit",Se);h.addEventListener("submit",he);ue.addEventListener("click",()=>{H.value=x.textContent,j.value=I.textContent,S(b,m),p(g)});B.addEventListener("click",()=>{h.reset(),S(h,m),p(M)});de.addEventListener("click",()=>{i.reset(),S(i,m),p(k)});Promise.all([D(),oe()]).then(([e,t])=>{x.textContent=t.name,I.textContent=t.about,B.style.backgroundImage=`url(${t.avatar})`,L=t._id,e.forEach(r=>{const o=$(r,{onPreviewPicture:J,onLikeIcon:V,onDeleteCard:(n,c)=>{O(c).then(()=>n.remove()).catch(s=>console.error(s))},onInfoClick:R},L);W.prepend(o)})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});const be=document.querySelectorAll(".popup");be.forEach(e=>{K(e)});
