(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=c(r);fetch(r.href,i)}})();const te=""+new URL("logo-DQ1BIEMY.svg",import.meta.url).href,oe=""+new URL("avatar-jDl9RI_U.jpg",import.meta.url).href,re=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,{onPreviewPicture:t,onLikeIcon:c,onDeleteCard:a,onInfoClick:r},i)=>{const u=re(),f=u.querySelector(".card__like-button"),p=u.querySelector(".card__control-button_type_delete"),L=u.querySelector(".card__control-button_type_info"),S=u.querySelector(".card__image"),y=u.querySelector(".card__like-count");return S.src=e.link,S.alt=e.name,u.querySelector(".card__title").textContent=e.name,y&&e.likes&&(y.textContent=e.likes.length),e.owner._id!==i&&p.remove(),c&&f.addEventListener("click",()=>c(f,e._id)),a&&p&&p.addEventListener("click",()=>a(u,e._id)),r&&L&&L.addEventListener("click",()=>r(e._id)),t&&S.addEventListener("click",()=>t({name:e.name,link:e.link})),u},j=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");h(t)}},C=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",j)},h=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",j)},ne=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{h(e)}),e.addEventListener("mousedown",c=>{c.target.classList.contains("popup")&&h(e)})},ce=(e,t,c,a)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(a.inputErrorClass),r.textContent=c,r.classList.add(a.errorClass)},R=(e,t,c)=>{const a=e.querySelector(`#${t.id}-error`);t.classList.remove(c.inputErrorClass),a.classList.remove(c.errorClass),a.textContent=""},se=(e,t,c)=>{if(t.validity.valid)R(e,t,c);else{let a="";t.validity.patternMismatch&&t.hasAttribute("data-error-message")?a=t.dataset.errorMessage:a=t.validationMessage,ce(e,t,a,c)}},ae=e=>e.some(t=>!t.validity.valid),le=(e,t,c)=>{ae(e)?P(t,c):ie(t,c)},P=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},ie=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},ue=(e,t)=>{const c=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);P(a,t),c.forEach(r=>{r.addEventListener("input",()=>{se(e,r,t),le(c,a,t)})})},de=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(c=>{c.addEventListener("submit",a=>a.preventDefault()),ue(c,e)})},E=(e,t)=>{const c=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);c.forEach(r=>{R(e,r,t)}),P(a,t)},d={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"bbd0ba39-a453-4894-b620-a60328db7664","Content-Type":"application/json"}},_=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),pe=()=>fetch(`${d.baseUrl}/users/me`,{headers:d.headers}).then(_),O=()=>fetch(`${d.baseUrl}/cards`,{headers:d.headers}).then(_),me=({name:e,about:t})=>fetch(`${d.baseUrl}/users/me`,{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e,about:t})}).then(_),_e=e=>fetch(`${d.baseUrl}/users/me/avatar`,{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:e})}).then(_),fe=({name:e,link:t})=>fetch(`${d.baseUrl}/cards`,{method:"POST",headers:d.headers,body:JSON.stringify({name:e,link:t})}).then(_),W=e=>fetch(`${d.baseUrl}/cards/${e}`,{method:"DELETE",headers:d.headers}).then(_),ye=(e,t)=>fetch(`${d.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:d.headers}).then(_);document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".logo").src=te;const e=document.querySelector(".profile__image");e.style.backgroundImage=`url(${oe})`;const t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};de(t);const c=document.querySelector(".places__list"),a=document.querySelector(".popup_type_edit"),r=a.querySelector(".popup__form"),i=r.querySelector(".popup__input_type_name"),u=r.querySelector(".popup__input_type_description"),f=document.querySelector(".popup_type_new-card"),p=f.querySelector(".popup__form"),L=p.querySelector(".popup__input_type_card-name"),S=p.querySelector(".popup__input_type_url"),y=document.querySelector(".popup_type_image"),w=y.querySelector(".popup__image"),H=y.querySelector(".popup__caption"),J=document.querySelector(".profile__edit-button"),V=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_edit-avatar"),g=x.querySelector(".popup__form"),z=g.querySelector(".popup__input"),v=document.querySelector(".popup_type_info"),K=v.querySelector(".popup__title"),b=v.querySelector(".popup__info"),T=v.querySelector(".popup__list"),A=v.querySelector(".popup__text");let B;const Q=n=>new Date(n).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),q=(n,o)=>{const s=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return s.querySelector(".popup__info-term").textContent=n+":",s.querySelector(".popup__info-description").textContent=o,s},Y=n=>{const l=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),s=l.querySelector(".popup__list-item_type_badge");return s.textContent=n.name,s.title=n.about,l},$=({name:n,link:o})=>{w.src=o,w.alt=n,H.textContent=n,C(y)},D=(n,o)=>{const l=n.classList.contains("card__like-button_is-active"),s=n.closest(".card").querySelector(".card__like-count");ye(o,l).then(m=>{s.textContent=m.likes.length,n.classList.toggle("card__like-button_is-active")}).catch(m=>console.error(m))},F=n=>{O().then(o=>{const l=o.find(s=>s._id===n);l&&(K.textContent="Информация о карточке",b.innerHTML="",T.innerHTML="",b.append(q("Описание",l.name)),b.append(q("Дата создания",Q(l.createdAt))),b.append(q("Владелец",l.owner.name)),b.append(q("Количество лайков",l.likes.length.toString())),l.likes.length>0?(A.textContent="Лайкнули:",l.likes.forEach(s=>{T.append(Y(s))})):A.textContent="Пока никто не лайкнул",C(v))}).catch(o=>console.error(o))},G=n=>{n.preventDefault();const o=n.submitter,l=o.textContent;o.textContent="Сохранение...",o.disabled=!0,me({name:i.value,about:u.value}).then(s=>{I.textContent=s.name,k.textContent=s.about,h(a)}).catch(s=>console.error(s)).finally(()=>{o.textContent=l,o.disabled=!1})},X=n=>{n.preventDefault();const o=n.submitter,l=o.textContent;o.textContent="Сохранение...",o.disabled=!0,_e(z.value).then(s=>{e.style.backgroundImage=`url(${s.avatar})`,h(x)}).catch(s=>console.error(s)).finally(()=>{o.textContent=l,o.disabled=!1})},Z=n=>{n.preventDefault();const o=n.submitter,l=o.textContent;o.textContent="Создание...",o.disabled=!0,fe({name:L.value,link:S.value}).then(s=>{const m=N(s,{onPreviewPicture:$,onLikeIcon:D,onDeleteCard:(M,U)=>{W(U).then(()=>M.remove()).catch(ee=>console.error(ee))},onInfoClick:F},B);c.prepend(m),h(f),p.reset(),E(p,t)}).catch(s=>console.error(s)).finally(()=>{o.textContent=l,o.disabled=!1})};r.addEventListener("submit",G),p.addEventListener("submit",Z),g.addEventListener("submit",X),J.addEventListener("click",()=>{i.value=I.textContent,u.value=k.textContent,E(r,t),C(a)}),e.addEventListener("click",()=>{g.reset(),E(g,t),C(x)}),V.addEventListener("click",()=>{p.reset(),E(p,t),C(f)}),Promise.all([O(),pe()]).then(([n,o])=>{I.textContent=o.name,k.textContent=o.about,e.style.backgroundImage=`url(${o.avatar})`,B=o._id,n.forEach(l=>{const s=N(l,{onPreviewPicture:$,onLikeIcon:D,onDeleteCard:(m,M)=>{W(M).then(()=>m.remove()).catch(U=>console.error(U))},onInfoClick:F},B);c.prepend(s)})}).catch(n=>{console.error("Ошибка при загрузке данных:",n)}),document.querySelectorAll(".popup").forEach(n=>{ne(n)})});
