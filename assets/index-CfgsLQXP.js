(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const I=e=>{e.classList.toggle("card__like-button_is-active")},P=e=>{e.remove()},N=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),A=(e,{onPreviewPicture:t,onLikeIcon:r,onDeleteCard:o},n)=>{const s=N(),i=s.querySelector(".card__like-button"),y=s.querySelector(".card__control-button_type_delete"),v=s.querySelector(".card__image"),k=s.querySelector(".card__like-count");return v.src=e.link,v.alt=e.name,s.querySelector(".card__title").textContent=e.name,k&&e.likes&&(k.textContent=e.likes.length),e.owner._id!==n&&y.remove(),r&&i.addEventListener("click",()=>r(i,e._id)),o&&y&&y.addEventListener("click",()=>o(s,e._id)),t&&v.addEventListener("click",()=>t({name:e.name,link:e.link})),s},w=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",w)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",w)},$=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",r=>{r.target.classList.contains("popup")&&l(e)})},W=(e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)},F=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""},D=(e,t,r)=>{if(t.validity.valid)F(e,t,r);else{let o="";t.validity.patternMismatch&&t.hasAttribute("data-error-message")?o=t.dataset.errorMessage:o=t.validationMessage,W(e,t,o,r)}},j=e=>e.some(t=>!t.validity.valid),J=(e,t,r)=>{j(e)?b(t,r):V(t,r)},b=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},V=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},H=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);b(o,t),r.forEach(n=>{n.addEventListener("input",()=>{D(e,n,t),J(r,o,t)})})},z=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(r=>{r.addEventListener("submit",o=>o.preventDefault()),H(r,e)})},_=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach(n=>{F(e,n,t)}),b(o,t)},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"bbd0ba39-a453-4894-b620-a60328db7664","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),K=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),R=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),G=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),Q=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),X=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};z(d);const M=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),f=S.querySelector(".popup__form"),O=f.querySelector(".popup__input_type_name"),T=f.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),a=C.querySelector(".popup__form"),Y=a.querySelector(".popup__input_type_card-name"),Z=a.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),B=L.querySelector(".popup__image"),ee=L.querySelector(".popup__caption"),te=document.querySelector(".profile__edit-button"),oe=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_edit-avatar"),p=x.querySelector(".popup__form"),re=p.querySelector(".popup__input");let h;const U=({name:e,link:t})=>{B.src=t,B.alt=e,ee.textContent=e,m(L)},ne=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,G({name:O.value,about:T.value}).then(o=>{q.textContent=o.name,g.textContent=o.about,l(S)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})},se=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Сохранение...",t.disabled=!0,Q(re.value).then(o=>{E.src=o.avatar,l(x)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})},ce=e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Создание...",t.disabled=!0,X({name:Y.value,link:Z.value}).then(o=>{const n=A(o,{onPreviewPicture:U,onLikeIcon:I,onDeleteCard:P},h);M.prepend(n),l(C),a.reset(),_(a,d)}).catch(o=>console.error(o)).finally(()=>{t.textContent=r,t.disabled=!1})};f.addEventListener("submit",ne);a.addEventListener("submit",ce);p.addEventListener("submit",se);te.addEventListener("click",()=>{O.value=q.textContent,T.value=g.textContent,_(f,d),m(S)});E.addEventListener("click",()=>{p.reset(),_(p,d),m(x)});oe.addEventListener("click",()=>{a.reset(),_(a,d),m(C)});Promise.all([R(),K()]).then(([e,t])=>{q.textContent=t.name,g.textContent=t.about,E.src=t.avatar,h=t._id,e.forEach(r=>{const o=A(r,{onPreviewPicture:U,onLikeIcon:I,onDeleteCard:P},h);M.prepend(o)})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});const ae=document.querySelectorAll(".popup");ae.forEach(e=>{$(e)});
